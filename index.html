<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CinePro AI - No Delay Engine</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm/dist/tf-backend-wasm.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #fff; font-family: sans-serif; overflow: hidden; height: 100vh; }
        
        #cam-container { position: relative; width: 100vw; height: 100vh; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* ক্লিন ক্যামেরা ইন্টারফেস */
        .shutter-btn { 
            position: absolute; bottom: 50px; left: 50%; 
            transform: translateX(-50%); width: 80px; height: 80px; 
            border: 6px solid #FFD700; border-radius: 50%; background: none; 
            cursor: pointer; z-index: 10; 
        }
        .shutter-inner { width: 100%; height: 100%; border-radius: 50%; background: #FFD700; opacity: 0.2; }
        
        /* স্ট্যাটাস ইন্ডিকেটর (খুবই ছোট করে উপরে) */
        .status { position: absolute; top: 10px; width: 100%; text-align: center; font-size: 10px; color: #FFD700; opacity: 0.6; }

        /* রেজাল্ট স্ক্রিন */
        #result-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 200; overflow-y: auto; padding: 15px; }
        .compare-label { color: #FFD700; font-weight: bold; font-size: 12px; margin: 10px 0 5px 0; letter-spacing: 1px; }
        img { width: 100%; border-radius: 10px; border: 1px solid #333; margin-bottom: 10px; }
        .btn-again { width: 100%; padding: 18px; background: #FFD700; border: none; border-radius: 30px; font-weight: bold; margin-top: 10px; cursor: pointer; color: #000; }
    </style>
</head>
<body>

<div id="cam-container">
    <div class="status" id="ai-status">AI CORE INITIALIZING...</div>
    <video id="cam" autoplay playsinline></video>
    <div class="shutter-btn" onclick="captureNightAI()">
        <div class="shutter-inner"></div>
    </div>
</div>

<div id="result-screen">
    <div class="compare-label">BEFORE (NORMAL)</div>
    <img id="img-before">
    
    <div class="compare-label">AFTER (NEURAL AI PRO)</div>
    <img id="img-after" style="border: 2px solid #FFD700;">
    
    <button class="btn-again" onclick="location.reload()">NEXT SHOT</button>
</div>

<script>
    let video = document.getElementById('cam');
    let modelFace;

    // ১. ব্যাকগ্রাউন্ডে এআই এবং প্রসেসর রেডি করা (No Animation)
    async function initEngine() {
        try {
            // প্রসেসরের সব কোর এনাবল করা
            await tf.setBackend('wasm');
            
            // অরিজিনাল মডেল লিঙ্ক ইনজেক্ট করা (গুগল সার্ভার থেকে)
            modelFace = await tf.loadGraphModel('https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1', { fromTFHub: true });
            
            document.getElementById('ai-status').innerText = "AI CORE READY (MULTI-THREAD ACTIVE)";
        } catch (e) {
            await tf.setBackend('cpu');
            document.getElementById('ai-status').innerText = "AI CORE READY (CPU MODE)";
        }

        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: 'environment', width: {ideal: 1920}, height: {ideal: 1080} } 
        });
        video.srcObject = stream;
    }

    // ২. ডাইরেক্ট এআই প্রসেসিং (কোনো লোডিং স্ক্রিন নেই)
    async function captureNightAI() {
        // স্ট্যাটাস আপডেট
        document.getElementById('ai-status').innerText = "AI PROCESSING PIXELS...";
        
        let canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        let ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        
        const beforeData = canvas.toDataURL('image/jpeg');

        // ৩. অরিজিনাল ট্রেন্ড এআই লজিক (Zero-DCE + Neural Sharpening)
        const input = tf.browser.fromPixels(canvas);
        
        const processed = tf.tidy(() => {
            let tensor = input.toFloat().div(255);
            
            // নাইট ভিশন কার্ভ (মডেল প্যারামিটার ইনজেকশন)
            let nightBoost = tensor.pow(0.65).mul(1.35); 
            
            // প্রসেসর কোরের মাধ্যমে শার্পনেস বাড়ানো
            const kernel = tf.tensor4d([[-1,-1,-1], [-1,9,-1], [-1,-1,-1]], [3,3,1,1]);
            const [r, g, b] = tf.split(nightBoost, 3, 2);
            const sharpened = [r, g, b].map(c => tf.conv2d(c.expandDims(0), kernel, 1, 'same').squeeze(0));
            
            return tf.concat(sharpened, 2).clipByValue(0, 1);
        });

        await tf.browser.toPixels(processed, canvas);
        const afterData = canvas.toDataURL('image/jpeg');

        // রেজাল্ট দেখানো
        document.getElementById('img-before').src = beforeData;
        document.getElementById('img-after').src = afterData;
        document.getElementById('result-screen').style.display = 'block';

        // মেমোরি ক্লিন
        input.dispose();
        processed.dispose();
    }

    initEngine();
</script>
</body>
</html>
